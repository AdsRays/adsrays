// src/insights/rules.js
export const rules = [
  {
    id: 'freq_high',
    when: m => m.freq >= 3.5 && m.reach > 0,
    say: [
      (m,F)=>`Перегрев частоты ${m.freq.toFixed(1)}. Лишние показы ≈ ${F.num(m.extraImpr)} (${F.money(m.extraBudget)}). Можно показать рекламу ещё ${F.num(m.extraReach)} людям без доп. бюджета.`,
      (m,F)=>`Частота ${m.freq.toFixed(1)} — аудитория устала. Около ${F.num(m.extraImpr)} показов «в никуда» (≈ ${F.money(m.extraBudget)}).`
    ],
    action: m => `Поставьте frequency cap 2–3/7 дней и добавьте 1–2 свежих креатива.`
  },
  {
    id: 'ctr_low',
    when: m => m.ctr < 0.01, // <1%
    say: [
      (m,F)=>`CTR ${F.pct(m.ctr)} — ниже добрых ориентиров (1–2%). Первый кадр: эмоция/проблема → выгода → один CTA.`,
      (m,F)=>`Кликают мало (${F.pct(m.ctr)}). Усильте хук, сформулируйте выгоду в цифрах.`
    ],
    action: m => `Цель CTR ≥ 1.0%.`
  },
  {
    id: 'cpm_high',
    when: m => m.cpm > 40,
    say: [
      (m,F)=>`CPM ${F.money(m.cpm, m.currency)} — выше среднего. Свежие креативы/новые интересы часто дают −10…−20%.`
    ],
    action: () => `Расширьте плейсменты (Reels) и тестируйте новые интересы.`
  },
  // Куда грузить креативы
  {
    id: 'where_put_creatives',
    when: m => true, // даём совет всегда, но ветвим текст по метрикам
    say: [
      (m,F)=> m.freq>=3.5 || m.ctr<0.01
        ? `Начните с обновления в текущей кампании (сохранится обучение). Если через 5–7 дней CTR < 1% или CPM > ${F.money(40,m.currency)} — запустите новую кампанию для «чистого старта».`
        : `Обновляйте креативы в текущей кампании: быстрее и нагляднее сравнение «до/после».`
    ],
    action: () => `Текущая кампания → новые креативы; при слабой динамике — новая кампания.`
  }
];
